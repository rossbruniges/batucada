{% extends "base.html" %}
{% load l10n_tags %}

{% block title %}{{ challenge.title }}{% endblock %}

{% block breadcrumbs %}

{% comment %}
let's exclude the Nav for "if (user.get_profile == challenge.created_by and challenge.project.name == 'MoJo') or (challenge.project.name != 'MoJo')"

instead, we should include "challenges/_challenge_sidebar.html" or whatever we need to do to make the /journalism header appear for MoJo-created challenges
{% endcomment %}

<div class="container">
    
  <nav>
    <a href="{% locale_url projects_gallery %}">{{ _('Projects') }}</a>
    <span class="arrow">&rsaquo;</span>
    <a href="{% locale_url projects_show slug=challenge.project.slug %}">{{ challenge.project.name }}</a>
    <span class="arrow">&rsaquo;</span>
    {{ challenge.title }}
  </nav>
  
  <div id="project-actions">
    {% if user.get_profile == challenge.created_by %}
    <a class="button" href="{% locale_url challenges_edit slug=challenge.slug %}">{{ _('Edit Challenge') }}</a>
    <a class="button" href="{% locale_url challenges_contact_entrants slug=challenge.slug %}">{{ _('Contact Entrants') }}</a>

    {% endif %}
  </div>
</div>

{% endblock %}

{% block bodyid %}voting_landing{% endblock %}
{% block body %}

<div id="sidebar">
<section id="challenge" class="panel">
    <header>
    <h1 id="challenge-title">{{ challenge.title }}</h1>    
    {% if challenge.project.slug != 'mojo' %}
    <h2 id="project-name">
      A challenge from <a href="{% locale_url projects_show slug=challenge.project.slug %}">{{ challenge.project.name }}</a>
    </h2>
    {% endif %}
    {% if challenge.project.slug == 'mojo' %}
    <h2 id="project-name">
      A challenge from  <a href="{% locale_url drumbeat_journalism %}">{{ challenge.project.name }}</a> 
    </h2>
    {% endif %}
{% if challenge.image %}
  <img src="{{ challenge.image.url }}" alt="{{ challenge }} image" width="280"/>  
  {% endif %}

    {% if challenge.is_active %}
    <dl id="project-stats">
      <dt>{{ _('Start date') }}:</dt>
      <dd>{{ challenge.start_date|date:"F d, Y" }}</dd>

      <dt>{{ _('End date') }}:</dt>
      <dd>{{ challenge.end_date|date:"F d, Y" }}</dd>      
    </dl>
    {% endif %}
    </header>
    <div class="challenge_sup">
   {% if challenge.above_fold %}
    {{ challenge.above_fold|safe }}
  {% endif %} 
  <div class="challenge_brief{% if challenge.above_fold  %} expando{% endif %}">
  {% if challenge.sidebar %}
    {{ challenge.sidebar|safe }}
  {% else %}
    {{ challenge.brief|safe }}
  {% endif %} 
  <p><a  href="{% locale_url challenges_show_full slug=challenge.slug %}">Read the full challenge brief</a></p>
  </div>
  </div>  
  </section>

</div>
<div id="main">
    <div class="voting-info">
        <h2>Voting is now open</h2>
        <p>Welcome to crowd evaluation. You can vote up ideas and leave comments for the authors. <strong>Voting ends June 19th</strong>.</p>
        <p><a href="{% locale_url drumbeat_journalism %}">Learn more about MoJo</a><p>
    </div>
    {% if submissions.object_list %}
        <h2>Ideas</h2>
        <ul id="votes" data-total-votes="{{ num_submissions }}">
        {% for submission in submissions.object_list %}
            <li class="submission">
                {% include "challenges/_voting_resource.html" %}
            </li>
        {% endfor %}
        </ul>
    {% endif %}
    {% if submissions.paginator.num_pages > 1 %}
        <div class="pagination">
            {% if submissions.has_previous %}
                <a href="?page={{ submissions.previous_page_number }}" class="btn">← prev</a>
            {% else %}
	            <span class="btn">← prev</span>
	        {% endif %}
            <em>Page {{ submissions.number }} of {{ submissions.paginator.num_pages }}</em>
            {% if submissions.has_next %}
                <a href="?page={{ submissions.next_page_number }}" class="btn">next →</a>
	        {% else %}
	            <span class="btn">next →</span>
            {% endif %}
        </div>
        <p><a href="{% locale_url all_submissions slug=challenge.slug %}">Browse all {{ nsubmissions }} submissions</a></p>
    {% endif %}
</div>
{% endblock %}
